# LGTMè‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«

## æ¦‚è¦

LGTMã™ã‚‹æ™‚ã€è‡ªåˆ†ã®å¥½ããªç”»åƒã§LGTMç”¨ã®æ–‡è¨€ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¨GASã‚’ä½¿ç”¨ã—è‡ªå‹•ç”Ÿæˆã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚   
Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¨­å®šã—ãŸç”»åƒã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã§LGTMç”¨ã®æ–‡è¨€ã‚’è‡ªå‹•ç”Ÿæˆã—ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚
å®Ÿè¡Œã™ã‚‹ã¨å³ä¸‹ã«ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚ŒãŸç”»åƒã‚’è¡¨ç¤ºã—ã¦ãã‚Œã¾ã™ã€‚  

![sample_create_LGTM](/image/sample_create_LGTM.gif)

å®Ÿè¡Œã™ã‚‹ã¨ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ä¸‹è¨˜ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã™ã®ã§ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã¦ä½¿ç”¨ã—ã¾ã™ã€‚

```markdown
# LGTM

![ãƒãƒ—ãƒ†ãƒ”ãƒ”ãƒƒã‚¯ï¼ˆä¿ºã ä¿ºã ä¿ºã ï¼‰](https://media2.giphy.com/media/EtFNtaj8sQKuA/giphy.gif?cid=e1bb72ff5c9057fd6276716c552fafa2)
```

## ä½¿ã„æ–¹

### Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«LGTMã§ä½¿ç”¨ã™ã‚‹ç”»åƒã®è¨­å®š

æ–°è¦ã§Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
ã‚·ãƒ¼ãƒˆåã¯`LGTM`ã«ã—ã¦ãã ã•ã„ã€‚
Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«LGTMã§ä½¿ç”¨ã—ãŸã„ç”»åƒã®URLã‚’è¨­å®šã—ã¾ã™ã€‚

![sample_spreadsheet](/image/sample_spreadsheet.png)

ä¸‹è¨˜ã®ã‚ˆã†ãªæ„Ÿã˜ã§Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’åŸ‹ã‚ã¾ã™ã€‚
imageåˆ—ã¯åˆ¥ã«è¨­å®šã—ãªãã¦ã‚‚è‰¯ã„ã§ã™ã€‚å¿…è¦ãªã®ã¯IDã€œdescriptionåˆ—ã¾ã§ã§ã™ã€‚

| ID  |  URL             | description       | image       |
|:----|:----------------:|:-----------------:|:-----------:|
| 1   |  LGTMç”»åƒï¼‘ã®URL |  LGTMç”»åƒï¼‘ã®èª¬æ˜ | =IMAGE(B2)  |
| 2   |  LGTMç”»åƒï¼’ã®URL |  LGTMç”»åƒï¼’ã®èª¬æ˜ | =IMAGE(B3)  |
| 3   |  LGTMç”»åƒï¼“ã®URL |  LGTMç”»åƒï¼“ã®èª¬æ˜ | =IMAGE(B4)  |
| 4   |  LGTMç”»åƒï¼”ã®URL |  LGTMç”»åƒï¼”ã®èª¬æ˜ | =IMAGE(B5)  |

### Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å†…å®¹ã‚’JSONã§å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‹ãã¾ã™ã€‚

![sample_spreadsheet](/image/sample_script_editor.png)

ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã«ä¸‹è¨˜ã®ã‚½ãƒ¼ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã—è²¼ã‚Šä»˜ã‘ä¿å­˜ã—ã¾ã™ã€‚
[https://github.com/dodonki1223/CreateLGTM/blob/master/LGTM.gs](https://github.com/dodonki1223/CreateLGTM/blob/master/LGTM.gs)

![sample_paste_source](/image/sample_paste_source.png)

Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦å…¬é–‹ã™ã‚‹

![sample_release](/image/sample_release.png)

![sample_release_setting](/image/sample_release_setting.png)

`ç¾åœ¨ã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®URL`ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§å©ãã¨ä¸‹è¨˜ã®ã‚ˆã†ã«JSONã‚’å–å¾—ã§ãã¦ã„ã‚Œã°å¤§ä¸ˆå¤«ã§ã™ã€‚

![sample_get_json](/image/sample_get_json.png)

### è‡ªå‹•ç”Ÿæˆç”¨ã®ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½œæˆã™ã‚‹

[https://github.com/dodonki1223/CreateLGTM/blob/master/bookmarklet.js](https://github.com/dodonki1223/CreateLGTM/blob/master/bookmarklet.js)ã®ã‚½ãƒ¼ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã—[ï¼’è¡Œç›®](https://github.com/dodonki1223/CreateLGTM/blob/2a6c9c8718ab620ac78bc34884947dbe92b7bf62/bookmarklet.js#L2)ã®URLã®éƒ¨åˆ†ã‚’å…ˆç¨‹ã‚³ãƒ”ãƒ¼ã—ãŸ`ç¾åœ¨ã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®URL`ã«æ›¸ãæ›ãˆãŸã®ã¡ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¨ã—ã¦ä¿å­˜ã™ã‚Œã°è¨­å®šå®Œäº†ã§ã™ã€‚

```JavaScript
javascript:(function(){
  const GAS_API_URL = 'https://script.google.com/macros/s/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/exec';

  let script = document.createElement('script');
  script.src = GAS_API_URL + '?callback=copyLgtm';
  document.body.appendChild(script);
  document.body.removeChild(script);

  window.copyLgtm = function(data) {
    let json = JSON.stringify(data);
    let jsonParse = JSON.parse(json);

    execCopy(jsonParse.data.lgtm);
    displayCopyImg(jsonParse.data.lgtm_url, jsonParse.data.description);
  };

  window.execCopy = function(string) {
    let copyElement = document.createElement('div');
    copyElement.style.cssText = 'position: fixed; right: 200%;';

    let pre = document.createElement('pre');
    pre.style.cssText = '-webkit-user-select: auto; user-select: auto;';

    copyElement.appendChild(pre).textContent = string;

    document.body.appendChild(copyElement);
    document.getSelection().selectAllChildren(copyElement);
    document.execCommand('copy');

    document.body.removeChild(copyElement);
  };

  window.displayCopyImg = function(lgtmImgUrl, description) {
    let displayElement = document.createElement('div');
    displayElement.style.cssText = 'position: fixed; bottom: 1%; right: 1%; z-index: 9999;';

    let p = document.createElement('p');
    p.textContent = description;
    p.style.cssText = 'position: absolute; top: 0; left: 0.5em; margin: 0; color :white; font-weight: bold;';
    displayElement.appendChild(p);

    let img = document.createElement('img');
    img.src = lgtmImgUrl;
    img.style.width = (window.parent.screen.width * 0.2) + 'px';
    displayElement.appendChild(img);

    document.body.appendChild(displayElement);

    setTimeout(function() {
      document.body.removeChild(displayElement);
    }, 3000);
  };
})();
```

### ç‰¹å®šã®ç”»åƒã‚’æŒ‡å®šã™ã‚‹

URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã‚·ãƒ¼ãƒˆåã‚„IDã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ç‰¹å®šã®ç”»åƒã‚’æŒ‡å®šã—ã¦LGTMã®æ–‡è¨€ã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  

[https://github.com/dodonki1223/CreateLGTM/blob/bc64d09d7997d17117878362dfea4409336432d8/bookmarklet.js#L5](https://github.com/dodonki1223/CreateLGTM/blob/bc64d09d7997d17117878362dfea4409336432d8/bookmarklet.js#L5)ã®ç®‡æ‰€ã«URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ç‰¹å®šã®ç”»åƒã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä¿®æ­£å‰

```JavaScript
  script.src = GAS_API_URL + '?callback=copyLgtm';
```

ä¿®æ­£å¾Œ

```JavaScript
  script.src = GAS_API_URL + '?callback=copyLgtm&sheet=interesting&id=2';
```

ã“ã®å ´åˆã§ã™ã¨ã€`interesting`ã‚·ãƒ¼ãƒˆã®`id`ãŒï¼’ã®ç”»åƒã§LGTMã®æ–‡è¨€ã‚’ä½œæˆã—ã¦ãã‚Œã¾ã™ã€‚
sheetã®æŒ‡å®šãŒç„¡ã„ã¨`LGTM`ã®ã‚·ãƒ¼ãƒˆãŒé¸æŠã•ã‚Œã¾ã™ã€‚ã¾ãŸ`id`ã®æŒ‡å®šãŒç„¡ã„ã¨ãƒ©ãƒ³ãƒ€ãƒ ã«é¸æŠã•ã‚Œã‚‹ä»•æ§˜ã«ãªã£ã¦ã„ã¾ã™ã€‚

## ãã®ä»–

githubã ã¨ä¸‹è¨˜ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ä½¿ç”¨ã§ãã¾ã›ã‚“ã€‚
githubä»¥å¤–ã§ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’ä½¿ç”¨ã—ã¦ä¸‹ã•ã„ã€‚

```
VM154:1 Refused to load the script 'https://script.google.com/macros/s/xxxxxxxxxxxxxxxxxx/exec?callback=copyLgtm' because it violates the following Content Security Policy directive: "script-src github.githubassets.com". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback.
```

ã“ã‚Œã¯ã©ã†ã—ãŸã‚‰è‰¯ã„ã®ã ã‚ã†ã‹â€¦â€¦ğŸ¤”  
githubã¯ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚’å®Ÿè¡Œã§ããªã„ã‚ˆã†ã 
